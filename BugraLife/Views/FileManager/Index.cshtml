@model BugraLife.Models.FileManagerViewModel

@{
    ViewData["Title"] = "Dosya Paylaşım";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid mt-4">

    <div class="card  border-secondary shadow-lg mb-4">
        <div class="card-body d-flex justify-content-between align-items-center">

            <div class="d-flex align-items-center">
                @if (Model.ParentPath != null)
                {
                    <a href="/FileManager/Index?path=@Model.ParentPath" class="btn btn-outline-secondary me-3" title="Bir Üst Klasör">
                        <i class="bi bi-arrow-90deg-up"></i>
                    </a>
                }
                else
                {
                    <button class="btn btn-outline-secondary me-3" disabled><i class="bi bi-hdd"></i></button>
                }

                <h5 class=" mb-0 font-monospace">
                    /paylasim/@(string.IsNullOrEmpty(Model.CurrentPath) ? "" : Model.CurrentPath)
                </h5>
            </div>

            <div>
                <button class="btn btn-outline-warning me-2 fw-bold" data-bs-toggle="modal" data-bs-target="#newFolderModal">
                    <i class="bi bi-folder-plus me-1"></i> Klasör
                </button>
                <button class="btn btn-primary fw-bold" data-bs-toggle="modal" data-bs-target="#uploadModal">
                    <i class="bi bi-cloud-upload me-1"></i> Yükle
                </button>
            </div>
        </div>
    </div>

    <div class="card  border-secondary shadow-lg min-vh-100">
        <div class="card-body">
            @if (Model.Directories.Count == 0 && Model.Files.Count == 0)
            {
                <div class="text-center py-5 text-secondary">
                    <i class="bi bi-folder2-open display-1"></i>
                    <p class="mt-3">Burası boş. Hadi bir şeyler yükle aga.</p>
                </div>
            }
            else
            {
                <div class="row g-3">

                    @foreach (var item in Model.Directories)
                    {
                        <div class="col-6 col-md-4 col-lg-2">
                            <div class="card  bg-opacity-10 border-0 h-100 folder-card position-relative">
                                <a href="/FileManager/Index?path=@item.Path" class="text-decoration-none  p-3 text-center d-block">
                                    <i class="bi @item.Icon display-4"></i>
                                    <div class="mt-2 text-truncate small fw-bold" title="@item.Name">@item.Name</div>
                                </a>

                                <button class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1 delete-btn"
                                        onclick="deleteItem('@item.Path', 'klasör')" style="opacity:0.8;">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                        </div>
                    }

                    @foreach (var item in Model.Files)
                    {
                        <div class="col-6 col-md-4 col-lg-2">
                            <div class="card  border border-secondary h-100 file-card position-relative">
                                <a href="/FileManager/Download?path=@item.Path" class="text-decoration-none  p-3 text-center d-block">
                                    <i class="bi @item.Icon display-4"></i>
                                    <div class="mt-2 text-truncate small" title="@item.Name">@item.Name</div>
                                    <div class="text-secondary small" style="font-size:0.7rem;">@item.Size</div>
                                </a>

                                <button class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1 delete-btn"
                                        onclick="deleteItem('@item.Path', 'dosya')" style="opacity:0.8;">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>

<div class="modal fade" id="newFolderModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content  border-secondary ">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">Yeni Klasör Oluştur</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form action="/FileManager/CreateFolder" method="post">
                <div class="modal-body">
                    <input type="hidden" name="currentPath" value="@Model.CurrentPath">
                    <label class="form-label text-secondary">Klasör Adı</label>
                    <input type="text" name="folderName" class="form-control   border-0" required placeholder="Örn: Belgeler">
                </div>
                <div class="modal-footer border-secondary">
                    <button type="submit" class="btn btn-warning fw-bold">Oluştur</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="uploadModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content  border-secondary ">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">Dosya Yükle</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form action="/FileManager/UploadFile" method="post" enctype="multipart/form-data">
                <div class="modal-body">
                    <input type="hidden" name="currentPath" value="@Model.CurrentPath">
                    <label class="form-label text-secondary">Dosyaları Seç</label>
                    <input type="file" name="files" class="form-control   border-0" multiple required>
                    <div class="form-text  mt-2">Birden fazla dosya seçebilirsin aga.</div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="submit" class="btn btn-primary fw-bold">Yüklemeyi Başlat</button>
                </div>
            </form>
        </div>
    </div>
</div>

<form id="deleteForm" action="/FileManager/Delete" method="post">
    <input type="hidden" name="path" id="deletePath">
</form>

<style>
    .folder-card:hover {
        background-color: rgba(255, 193, 7, 0.2) !important;
        transition: 0.3s;
    }

    .file-card:hover {
        border-color: #ffc107 !important;
        transition: 0.3s;
    }

    .delete-btn {
        display: none;
    }

    .folder-card:hover .delete-btn, .file-card:hover .delete-btn {
        display: block;
    }
</style>

@section Scripts {
    <script>
        function deleteItem(path, type) {
            Swal.fire({
                title: 'Emin misin?',
                text: `Bu ${type} kalıcı olarak silinecek!`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonText: 'Vazgeç',
                confirmButtonText: 'Evet, Sil',
                background: '#252b36', color: '#fff'
            }).then((result) => {
                if (result.isConfirmed) {
                    $('#deletePath').val(path);
                    $('#deleteForm').submit();
                }
            });
        }
    </script>
}